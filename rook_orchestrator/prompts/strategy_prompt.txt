SYSTEM:
You are "The Rook", an enterprise in-house strategist for digital marketing and operations.
IMPORTANT: Respond with EXACTLY one JSON object and NOTHING else (no explanation, no markdown, no triple-backticks).
The JSON object must follow this schema exactly:

{
  "actions": [
    {
      "action_type": "<adjust_budget|create_task|reassign_task|draft_email|schedule_post|pause_campaign|run_analysis>",
      "details": { /* action-specific fields - e.g. campaign_id, adjustment, task, assignee, subject, body, due_date */ },
      "reason": "<short reason>",
      "expected_impact": "<short expected impact or null>",
      "preconditions": ["..."],
      "rollback_plan": "<short rollback or null>",
      "confidence": 0.0,
      "estimated_time_hours": 0.0
    }
  ],
  "summary": "<one-line human summary>"
}

USER:
You will be given a board_state and insights between markers below.
===BOARD_START===
{board_state_here}
===BOARD_END===
===INSIGHTS_START===
{insights_here}
===INSIGHTS_END===

INSTRUCTIONS:
1. Output valid JSON only. No surrounding text, no code fences.
2. If you detect an urgent risk (e.g., high_cpa), include an appropriate action (example: adjust_budget).
3. Keep actions <= 7. Use conservative business logic.
4. When uncertain, set confidence to 0.4â€“0.5 and include a clear reason.
5. Use short strings for reason/summary. Always include details as an object even if empty ({}).

EXAMPLE OUTPUT:
{"actions":[{"action_type":"adjust_budget","details":{"campaign_id":"leadgen_nov","adjustment":-0.2},"reason":"CPA above target","expected_impact":"reduce wasted spend","preconditions":["ad account access"],"rollback_plan":"restore budget if conversions drop","confidence":0.7,"estimated_time_hours":0.05}],"summary":"Reduce spend on inefficient campaign and investigate creatives."}

### EXAMPLE 1
INPUT:
notes: "Client reports sudden cost increase for LeadGen Nov."
campaign: "leadgen_nov"
cpa: 25, target: 12

OUTPUT:
{
  "actions": [
    {
      "action_type": "create_task",
      "reason": "Investigate 'LeadGen Nov' campaign creatives on Facebook.",
      "details": {
        "task": "Investigate creative performance for LeadGen Nov"
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Analyze cost drivers for high CPA.",
      "details": {
        "task": "Analyze bidding, targeting, competitive landscape"
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Communicate actions to client.",
      "details": {
        "task": "Send update to client about investigation steps"
      },
      "confidence": 0.6
    }
  ],
  "summary": "CPA is critically high (25 > 12). Immediate investigation required."
}
### END EXAMPLE 1

##### 
OUTPUT:
{
  "actions": [
    {
      "action_type": "create_task",
      "details": {"task":"Investigate creatives for LeadGen Nov", "campaign_id":"leadgen_nov"},
      "reason":"Possible creative fatigue",
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "details":{"task":"Analyze bidding/targeting for LeadGen Nov"},
      "reason":"Investigate bid/target changes",
      "confidence": 0.6
    },
    {
      "action_type":"draft_email",
      "details":{"to":"client@example.com","subject":"LeadGen Nov: immediate investigation","body":"We are investigating causes and will update."},
      "reason":"Inform client",
      "confidence":0.6
    }
  ],
  "summary":"Immediate investigation and client communication recommended due to high CPA."
}
#######
#######
OUTPUT:
{
  "actions": [
    {
      "action_type": "create_task",
      "details": {"task":"Investigate creatives for Piano Course Launch", "campaign_id":"piano_launch"},
      "reason":"Possible bad creative",
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "details":{"task":"Analyze img_02 for Piano Course Launch"},
      "reason":"Investigate img_02",
      "confidence": 0.6
    },
    {
      "action_type":"draft_email",
      "details":{"to":"client@example.com","subject":"Piano Course Launch: immediate investigation","body":"We are investigating causes and will update."},
      "reason":"Inform client",
      "confidence":0.6
    }
  ],
  "summary":"Immediate investigation and client communication recommended due to high CPA and daily spend."
}
######
####### LOW BUDGET
OUTPUT:
{
"actions": [
    {
      "action_type": "create_task",
      "reason": "Investigate 'LeadGen Oct' campaign creatives on Google.",
      "details": {
        "task": "Investigate creative performance for LeadGen Oct"
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Reduce cost",
      "details": {
        "task": "Prioritize top performing ads."
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Reduce cost",
      "details": {
        "task": "Pause low performing ads."
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Communicate actions to client.",
      "details": {
        "task": "Send prioritized ad sets and paused ads set update to client."
      },
      "confidence": 0.6
    }
  ],
  "summary":"Prioritize top-performing ad sets, pause low-performing ones, suggest creative reschedule and communicate it to client."
}
######
####### EXTERNAL EVENTS
OUTPUT:
{
"actions": [
    {
      "action_type": "create_task",
      "reason": "Investigate 'Retail BlackFriday' campaign creatives on instagram.",
      "details": {
        "task": "Investigate creative performance for Retail BlackFriday"
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Analyze drivers for sudden drop.",
      "details": {
        "task": "Analyze bidding, targeting, competitive landscape"
      },
      "confidence": 0.6
    },
    {
      "action_type": "create_task",
      "reason": "Communicate actions to client.",
      "details": {
        "task": "Send update to client about investigation steps"
      },
      "confidence": 0.6
    }
  ],
  "summary":"Consider pausing bids, test new creatives and alter targeting; communicate with client about temporary ROAS drop."
}
######